---
title: "[ESG Centre of Excellence](https://www.esgbc.ca) Dashboard"
execute: 
  echo: false
format:
   dashboard:
     logo: ../02_images/BCID_V_rgb_rev.png
     nav-buttons:
        icon: github
        href: https://github.com/bcgov-c/esg-dashboard
     self-contained: true
     css: ../03_styles/styles.css
---

```{r license}
# Copyright 2024 Province of British Columbia
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and limitations under the License.
```

```{r packages}
#| output: false
library(tidyverse)
library(plotly)
library(scales)
library(janitor)
library(lubridate)
library(crosstalk)
library(htmltools)
library(DT)
```

```{r data}
source("../01_data/data.R")
```

# Environment

##  {.sidebar width="18%"}

### Information

Switch between tabs in the top row to view the proportion of energy use and GHG emissions by fuel source.

Expand the year range on the line charts by adjusting the range slider.

Expand the charts by hovering over the bottom right corner and click on the icon.

Switch between the tabs in the bottom row to see total energy use and GHG emissions per employee, by Industry.

::: {.callout-note collapse="true"}
### Notes

The fuel source charts do not give a complete picture as they do not include data from manufacturing.

The industry charts do not include data for agriculture or manufacturing sector as it is not available.
:::

\

::: {.callout-note collapse="true"}
### Sources

[Government of BC](https://www2.gov.bc.ca/gov/content/environment/climate-change/data/industrial-facility-ghg)

[Natural Resources Canada](https://oee.nrcan.gc.ca/corporate/statistics/neud/dpa/menus/trends/comprehensive/trends_agg_bct.cfm)
:::

## Column {width="82%"}

### Row {.tabset height="60%"}

```{r line-use-perc}
#| title: Energy Use by Fuel Source (%)
#| warning: false

plot_data <- line_data %>%
  filter(Topic == "Energy Use") %>%
  mutate(Date = ymd(paste0(Year, "-01-01")))

plot_ly(data = plot_data,
        x = ~Date,
        y = ~Value,
        color = ~Variable,
        type = "scatter",
        mode = "lines+markers",
        text = ~ paste0(Variable, ": ", percent(Value, accuracy = 0.1)),
        textposition = "none",
        hovertemplate = "%{x} %{text}<extra></extra>") %>%
  layout(yaxis = list(title = "", tickformat = "0%"),
         xaxis = list(title = "", hoverformat = "%Y", tickformat = "%Y")) %>%
    rangeslider(start = ymd("2010-12-01"),
                end = ymd("2021-02-01"),
                bgcolor = "#efefef")

```

```{r line-ghg-perc}
#| title: GHG Emissions by Fuel Source (%)
#| warning: false

plot_data <- line_data %>%
  filter(Topic == "GHG Emissions") %>%
  mutate(Date = ymd(paste0(Year, "-01-01")))

plot_ly(data = plot_data,
        x = ~Date,
        y = ~Value,
        color = ~Variable,
        type = "scatter",
        mode = "lines+markers",
        text = ~ paste0(Variable, ": ", percent(Value, accuracy = 0.1)),
        textposition = "none",
        hovertemplate = "%{x} %{text}<extra></extra>") %>%
  layout(yaxis = list(title = "", tickformat = "0%"),
         xaxis = list(title = "", hoverformat = "%Y", tickformat = "%Y")) %>%
    rangeslider(start = ymd("2010-12-01"),
                end = ymd("2021-02-01"),
                bgcolor = "#efefef")

```

### Row {height="40%"}

#### Column {.tabset}

```{r bar-use-peremp}
#| title: Energy Use by Industry

data <- bar_data %>%
  filter(str_detect(Indicator, "Energy Use"))

plot_ly(data,
        type = "bar",
        x = ~Value,
        y = ~Variable,
        text = ~paste0(Year, ": ", comma(Value, accuracy = 0.001), " gigajoules"),
        textposition = "none",
        hovertemplate = "%{text}<extra></extra>",
        color = ~Year) %>%
    layout(xaxis = list(title = list(text = "Energy Use per Employee (in Gigajoules)"), tickformat = "0.0f"),
           yaxis = list(title = ""),
           barmode = "group",
           hovermode = "y unified",
           legend = list(traceorder = "reversed"))
```

```{r bar-ghg-peremp}
#| title: GHG Emissions by Industry

data <- bar_data %>%
  filter(str_detect(Indicator, "GHG Emissions")) 

plot_ly(data,
        type = "bar",
        x = ~Value,
        y = ~Variable,
        text = ~paste0(Year, ": ", comma(Value, accuracy = 0.1), " MT of CO2e"),
        textposition = "none",
        hovertemplate = "%{text}<extra></extra>",
        color = ~Year) %>%
    layout(xaxis = list(title = "GHG Emissions per Employee (in MT of CO2e)", tickformat = "0.0f"),
           yaxis = list(title = ""),
           barmode = "group",
           hovermode = "y unified",
           legend = list(traceorder = "reversed"))
```

#### Column

```{r bar-use-perc}
#| title: Proportion of Energy Use by Industry

data <- bar_data %>%
  filter(str_detect(Indicator, "%"))

plot_ly(data,
        type = "bar",
        x = ~Value,
        y = ~Year,
        text = ~paste0(Variable, ": ", percent(Value, accuracy = 0.1)),
        textposition = "none",
        hovertemplate = "%{text}<extra></extra>",
        color = ~Variable) %>%
    layout(xaxis = list(title = "Percent of Energy Use",
                        tickformat = "0%"),
           yaxis = list(title = ""),
           barmode = "stack",
           hovermode = "y unified")
```

# Social

##  {.sidebar width="18%"}

### Sidebar

## Column {width="82%"}

Main content

# Governance

##  {.sidebar width="18%"}

### Sidebar

## Column {width="82%"}

Main content

# Data

## Row {.tabset}

::: {.card title="Environment"}
#### Fuel Source Data

```{r}
datatable(line_data %>% rename(`Fuel Source` = Variable))
```

#### Industry Data

```{r}
datatable(bar_data %>% rename(`Industry` = Variable))
```
:::

::: {.card title="Social"}
Social Data
:::

::: {.card title="Governance"}
Governance Data
:::

# About
